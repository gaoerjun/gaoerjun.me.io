<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>任意轴旋转三维标签云</title>
    <script type="text/javascript">
        function DrawBall(){
            this.radius=250;
            this.angles=[];
            this.length=25;
            this.all=[];
            this.text=["zTree","BOM","DOM","xhtml","div+css","ssh","nodejs","springMVC","css3","html5","css","html","javascript","php","jquery","ECMAScript","Android","java","spring","hibernate","struts2","springside","severlet","session","jsp"];
        }
        DrawBall.prototype={
            angle:function(){
                var num=0;
                for(var i=0;i<this.length;i++){
                    var obj={};
                    if(i==0){
                        obj.theta=0;
                        obj.phi=0;
                    }
                    if(i>0&&i<4){
                        obj.theta=Math.PI/6*1;
                        obj.phi=Math.PI*2/3*num;
                        num++
                    }
                    if(i>3&&i<9){
                        obj.theta=Math.PI/6*2;
                        obj.phi=Math.PI*2/5*num;
                        num++
                    }
                    if(i>8&&i<16){
                        obj.theta=Math.PI/6*3;
                        obj.phi=Math.PI*2/7*num;
                        num++
                    }
                    if(i>15&&i<21){
                        obj.theta=Math.PI/6*4;
                        obj.phi=Math.PI*2/5*num;
                        num++
                    }
                    if(i>20&&i<24){
                        obj.theta=Math.PI/6*5;
                        obj.phi=Math.PI*2/3*num;
                        num++
                    }
                    if(i>23){
                        obj.theta=Math.PI;
                        obj.phi=0;
                    }
                    this.angles.push(obj);
                }
            },
            draw:function(){
                this.angle();
                var radius=this.radius;
                for(var i=0;i<this.length;i++){
                    var theta=this.angles[i].theta;
                    var phi=this.angles[i].phi;
                    var z=radius*Math.sin(theta)*Math.cos(phi);
                    var x=radius*Math.sin(theta)*Math.sin(phi)+250;
                    var y=radius*Math.cos(theta)+250;
                    var li=document.createElement('li');
                    li.innerText=this.text[i];
                    li.style.cssText="left:"+x+"px;top:"+y+"px";
                    if(i==24){
                        li.style.transform="translateZ("+10+"px) rotateY("+phi+"rad) rotateX("+(theta-Math.PI/2)+"rad)";
                    }else{
                        li.style.transform="translateZ("+z+"px) rotateY("+phi+"rad) rotateX("+(theta-Math.PI/2)+"rad)";
                    }
                    this.all.push(li);
                }
            }
        }
    </script>
    <script type="text/javascript">
        //鼠标旋转事件
        function mouseScroll(obj,upfun,downfun){

            if(obj.attachEvent){
                obj.addAttachment('onmousewheel',scrollFun);
            }else if(obj.addEventListener){
                obj.addEventListener('mousewheel',scrollFun,false);
                obj.addEventListener('DOMMouseScroll',scrollFun,false);
            }

            function scrollFun(evt){
                var e=evt||window.event;
                var num=e.wheelDelta||e.detail;
                if(num==120||num==-3){
                    if(upfun){
                        upfun.call(obj);
                    }
                }else if(num==-120||num==3){
                    if(downfun){
                        downfun.call(obj)
                    }
                }
                if(e.preventDefault){
                    e.preventDefault();
                }else{
                    e.returnValue=false;
                }
            }
        }

        //数学函数
        function math () {
            this.z=[0,0,1];
            this.mouse=[0,1,0];
            this.xiangl=[];
            this.theta=0;
            this.arr=[];

        }
        math.prototype={
            rotates:function () {
                var theta=this.theta*Math.PI/180;
                var xiangl=this.cha();
                var sqrt = Math.sqrt(xiangl[0] * xiangl[0] + xiangl[1] * xiangl[1] + xiangl[2] * xiangl[2]);
                var u = xiangl[0] / sqrt;
                var v = xiangl[1] / sqrt;
                var w = xiangl[2] / sqrt;
                var newarr = [];
                newarr[0]=Math.cos(theta) + (u * u) * (1 - Math.cos(theta));
                newarr[1]=u * v * (1 - Math.cos(theta)) + w * Math.sin(theta);
                newarr[2]=u * w * (1 -Math.cos(theta)) - v * Math.sin(theta);
                newarr[3]=0;

                newarr[4]=u * v * (1 - Math.cos(theta)) - w * Math.sin(theta);
                newarr[5]=Math.cos(theta) + v * v * (1 - Math.cos(theta));
                newarr[6]=w * v * (1 - Math.cos(theta)) + u * Math.sin(theta);
                newarr[7]=0;

                newarr[8]=u * w * (1 - Math.cos(theta)) + v * Math.sin(theta);
                newarr[9]=v * w * (1 - Math.cos(theta)) - u * Math.sin(theta);
                newarr[10]=Math.cos(theta) + w * w * (1 - Math.cos(theta));
                newarr[11]=0;

                newarr[12]=0;
                newarr[13]=0;
                newarr[14]=0;
                newarr[15]=1;

                this.arr=newarr;
            },
            cha:function () {
                var newarr=[];
                var arr1=this.z;
                var arr2=this.mouse;
                var x1=arr1[0];
                var y1=arr1[1];
                var z1=arr1[2];
                var x2=arr2[0];
                var y2=arr2[1];
                var z2=arr2[2];
                return this.xiangl=[y1*z2-z1*y2,z1*x2-x1*z2,x1*y2-y1*x2];
            }
        }
    </script>
    <script type="text/javascript">
        window.onload=function () {
            var ball=document.getElementsByTagName("ul")[0];
            var scence=document.getElementById('sence');
            var out=document.getElementById('out');
            //绘制球
            var balls=new DrawBall();
            balls.draw();
            for(var i=0;i<balls.length;i++){
                ball.appendChild(balls.all[i]);
            }
            //放大缩小球
            var startz=-300;
            var steps=10;
            mouseScroll(scence,function(){
                startz+=steps;
                out.style.transform="translateZ("+startz+"px)"
            },function(){
                startz-=steps;
                out.style.transform="translateZ("+startz+"px)"
            });
            //旋转球
            var maths=new math();
            var step=2;
            maths.mouse=[1,0,0];
            function moves () {
                if(step>2){
                    step*=0.9
                }else{
                    step=2;
                }
                maths.theta+=step;
                maths.rotates();
                var arr=maths.arr;
                ball.style.transform="matrix3d("+arr[0]+","+arr[1]+","+arr[2]+","+arr[3]+","+arr[4]+","+arr[5]+","+arr[6]+","+arr[7]+","+arr[8]+","+arr[9]+","+arr[10]+","+arr[11]+","+arr[12]+","+arr[13]+","+arr[14]+","+arr[15]+")";
            }
            var t=setInterval(moves,60)
            //通过鼠标控制球的旋转方向和速度
            scence.onmousedown=function  (e) {
                var ev=e||window.event;
                var lx=ev.clientX-scence.offsetLeft-250;
                var ly=ev.clientY-scence.offsetTop-250;
                var end;
                clearInterval(t);
                document.onmousemove=function  (e) {
                    var ev=e||window.event;
                    var cx=ev.clientX-scence.offsetLeft-250;
                    var cy=ev.clientY-scence.offsetTop-250;
                    end=Math.sqrt((cx-lx)*(cx-lx)+(cy-ly)*(cy-ly));
                    step=end/5;
                    maths.mouse=[cx,cy,0];
                    maths.theta+=step;
                    maths.rotates();
                    var arr=maths.arr;
                    ball.style.transform="matrix3d("+arr[0]+","+arr[1]+","+arr[2]+","+arr[3]+","+arr[4]+","+arr[5]+","+arr[6]+","+arr[7]+","+arr[8]+","+arr[9]+","+arr[10]+","+arr[11]+","+arr[12]+","+arr[13]+","+arr[14]+","+arr[15]+")";
                    lx=cx;
                    ly=cy;
                }
                document.onmouseup=function  (e) {
                    var ev=e||window.event;
                    var ox=ev.clientX-scence.offsetLeft-250;
                    var oy=ev.clientY-scence.offsetTop-250;
                    document.onmousemove=null;
                    document.onmouseup=null;
                    maths.mouse=[ox,oy,0];
                    step=end;
                    maths.rotates();
                    var arr=maths.arr;
                    t=setInterval(moves,60)
                }
            }
        }
    </script>
    <style type="text/css">
        body{
            margin:0;
            padding:0;
            background:#111111;
        }
        ul,li{
            margin:0;
            padding:0;
            list-style: none;
        }
        .sence{
            width:500px;
            height:500px;
            margin:30px auto;
            perspective: 1500px;
        }
        .out{
            width:100%;
            height:100%;
            position: relative;
            transform-style: preserve-3d;
            transform:translateZ(-300px);
        }
        .ball{
            position: relative;
            width:100%;
            height:100%;
            transform-style: preserve-3d;
        }
        .ball li{
            position:absolute;
            width:80px;
            height:50px;
            background:rgba(32,163,115,1);
            padding:3px;
            background-clip: content-box;
            border-radius: 10%;
            border:1px solid #238a64;
            box-shadow: 0 0 15px #41cd9a;
            text-align: center;
            line-height: 50px;
            color:#FFFFEE;
            font-size: 14px;
            text-shadow: 0 0 4px #000;
            font-family: "微软雅黑";
            transform-origin: left;
        }
    </style>
</head>
<body>
<div class="sence" id="sence">
    <div class="out" id="out">
        <ul class="ball">
        </ul>
    </div>
</div>
</body>
</html>